---
title: "Exploratory Data Analysis of Washington State Crash Data"
author: J. Bravo
date: "December 4, 2023"
---
Import necessary libraries.
Will import data.table package to make importing of CSV file faster.
```{r}
library(dplyr) # for functions
library(data.table)
#library(ggplot2)
library(RColorBrewer)
```
Reside in same directory as the dataset(s).
```{r}
location <- getwd()
location
```
Import the dataset.
```{r}
raw_data <- fread("/Volumes/my_passport/data_sets/WA_Crash_Summary.csv")
```
Size of the dataframe.
```{r}
dim(raw_data)
```
According to the command above, this sample is 330k rows by 25 columns.
Want a sample of the first six entries.
```{r}
head(raw_data)
```
Datatype check.
```{r}
print(class(raw_data))
```
Dataype check on a column.
```{r}
print(class(raw_data$"Pedestrians Involved"))
print(class(raw_data$"Pedalcyclists Involved"))
```
Column names of the data frame.
```{r}
colnames(raw_data)
```
Get unique categories in a column
```{r}
unique(raw_data$"City")
unique(raw_data$"Hit and Run")
```
The cities column has 281 unique entries, whereas the Hit and Run column is boolean T or F.
Store the number of records in its own variable for later analysis.
```{r}
num_of_records <- nrow(raw_data)
num_of_records
```
Check the unique values in Injury Severity.
```{r}
unique(raw_data$"Injury Severity")
```
Want new dataframe to hold those records where only "Unknown Injury Collision" is in the "Injurity Severity" field.
```{r}
unknowns <- raw_data %>%
    filter(raw_data$"Injury Severity" == "Unknown Injury Collision")
num_of_unknowns <- nrow(unknowns)
```
Get proportion of entries that have "Unknown Injury Collision" status
```{r}
num_of_unknowns / num_of_records
```
So according to above results, about 10% of collisions are categorized as Unknown.
Similar analysis for the proportion of accidents categorized as "Serious Injury Collision"
```{r}
serious <- raw_data %>%
    filter(raw_data$"Injury Severity" == "Serious Injury Collision")
num_of_serious <- nrow(serious)
num_of_serious / num_of_records
```
So only about a percent of the collisions have been reported as Serious.
Following is used to get the number of unique caegories within a column.
```{r}
categories <- unique(yourDataFrame$yourColumn)
numberOfCategories <- length(categories)
```
Get number of "Fatal Collisions", "No Injury Collision", and "Minor Injury Collision" "Injury Severity" types.
```{r}
# No injury collision
no_coll <- raw_data %>%
    filter(raw_data$"Injury Severity" == "No Injury Collision")
num_of_no_coll <- nrow(no_coll)
# Minor injury collision
minor_coll <- raw_data %>%
    filter(raw_data$"Injury Severity" == "Minor Injury Collision")
num_of_minor_coll <- nrow(minor_coll)
# Fatal collision
fatal <- raw_data %>%
    filter(raw_data$"Injury Severity" == "Fatal Collision")
num_of_fatal <- nrow(fatal)
```
Plot to earlier results to see how the different categories compare.
```{r}
# Create data
plotting_data <- data.frame(
  name = c(
    "No Injury Collision"
    , "Minor Injury Collision"
    , "Serious Injury Collision"
    , "Fatal Collision"
    , "Unknown Injury Collision"
    ),
  value = c(
    num_of_no_coll
    , num_of_minor_coll
    , num_of_serious
    , num_of_fatal
    , num_of_unknowns
    )
)
# Open jpeg file
jpeg("rplot.jpg")
coul <- brewer.pal(5, "Accent") ## variable to store plot style
barplot(height = plotting_data$value, names = plotting_data$name,
        col = coul,
        las = 1,
        cex.names = 0.55
        ) ## Plot 1
# Close the file
dev.off()
```
So, "No Injury Collision" is the most likely outcome from the "Injury Severity" field. This is followed
by "Minor Injury Collision" and "Unknown Injury Collision" as the third likely outcome.
Now, want to check the unique values in the "Collision Type" column/field.
```{r}
unique(raw_data$"Collision Type")
```
The "Collision Type" field is filled with NA's, i.e. the column is not populated. Confirmed with a brief view
of the CSV file in Excel. Will remove this field as a dependent variable.
Next, to investigate the options in the "Lighting Condition" column.
```{r}
unique(raw_data$"Lighting Condition")
```
There are ten unique values but with some ambiguity. There is "Unknown", "Other", and "".
Get the sum of NAs in the column.
```{r}
sum(is.na(raw_data$"Lighting Condition"))
```
Get a dataframe where "Lighting Condition" is "".
```{r}
na_lighting_cond <- raw_data %>%
    filter(raw_data$"Lighting Condition" == "")
```
Get the count of the above dataframe.
```{r}
nrow(na_lighting_cond)
```
There are 509 records in this dataframe.
Want the proportion of records that are Hit and Run instances.
```{r}
nrow(raw_data %>% filter(raw_data$"Hit and Run" == "Y")) / num_of_records
```
Want the proportion of records that are not Hit and Run instances.
```{r}
nrow(raw_data %>% filter(raw_data$"Hit and Run" == "N")) / num_of_records
```
Now, want to see the unique values in the "Weather Condition" field.
```{r}
unique(raw_data$"Weather Condition")
```

```{r}
nrow(raw_data %>%
    filter(raw_data$"Weather Condition" == "Clear"))
```
Want a brief view of the "Damage Threshold Met" column values. I believe (need to confirm) that Damage
Threshold Met if damage is over $1,000.
```{r}
unique(raw_data$"Damage Threshold Met")
```
Determine the data type that R categorizes the "Collision Date" field. In this column is the time.
Want to determine if this is a predictor to include in my model
```{r}
class((raw_data$"Collision Date"))
```
Data type is NULL.
A library to deal with times and dates.
```{r}
library(lubridate)
```
Check out a quick sample
```{r}
head((raw_data$"Collision Date"))
```
Change it to more appropriate date format and double-check the data type.
```{r}
raw_data$"Collision Date" <- mdy_hms(raw_data$"Collision Date")
class((raw_data$"Collision Date"))
```
Want to determine if the time is in military time
```{r}
print(raw_data$"Collision Date")
```
It is indeed in military time.
```{r}
sample_date <- raw_data$"Collision Date"[[190]]
sample_date
```
Prototyping extracting the hour and minute from the date above.
```{r}
hr_and_min <- hour(sample_date) + minute(sample_date) / 60
hr_and_min
```
See if I can get the date column into a more appropriate column for analysis.
Will create function to return minute as a decimal of an hour.
```{r}
min_to_dec <- function(x) {
    return(hour(x) + minute(x) / 60)
}
```

```{r}
date_col <- raw_data$"Collision Date" %>% as.data.frame()
hours_and_minutes <-
    lapply(date_col, min_to_dec)
hours_and_minutes <- hours_and_minutes %>% as.data.frame()
```
Successfully turned a 24 hour reporting column to a numeric using just the hour and minutes.
Now, want the dimensions of the new data frame.
```{r}
dim(hours_and_minutes)
```
Separate the Injury Severity column.
```{r}
collision_col <- raw_data$"Injury Severity"
collision_col <- collision_col %>% as.data.frame()
typeof(collision_col)
```
Get the dimensions of the new collision column to make sure they are compatible with the time column.
```{r}

```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```
```{r}
```